{% extends 'base.html' %}
{% load static %}

{% block title %}{{ teacher.get_full_name }} - Teacher Details - LearnIspire{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2">
            <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Admin Portal</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'admin_dashboard:home' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-dashboard me-2"></i> Dashboard
                    </a>
                    <a href="{% url 'admin_dashboard:students' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-users me-2"></i> Students
                    </a>
                    <a href="{% url 'admin_dashboard:teachers' %}" class="list-group-item list-group-item-action active">
                        <i class="fa fa-chalkboard-teacher me-2"></i> Teachers
                    </a>
                    <a href="{% url 'admin_dashboard:pending_demos' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-clock-o me-2"></i> Pending Demos
                        {% if pending_demo_count %}<span class="badge bg-warning ms-2">{{ pending_demo_count }}</span>{% endif %}
                    </a>
                    <a href="{% url 'admin_dashboard:leave_requests' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-calendar-minus-o me-2"></i> Leave Requests
                        {% if pending_leave_count %}<span class="badge bg-warning ms-2">{{ pending_leave_count }}</span>{% endif %}
                    </a>
                    <a href="{% url 'admin_dashboard:payments' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-credit-card me-2"></i> Payments
                    </a>
                    <a href="{% url 'admin_dashboard:teacher_earnings' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-money me-2"></i> Teacher Payments
                    </a>
                    <a href="{% url 'admin:index' %}" class="list-group-item list-group-item-action">
                        <i class="fa fa-cogs me-2"></i> Django Admin
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-10">
            <div class="row mb-4">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'admin_dashboard:teachers' %}">Teachers</a></li>
                            <li class="breadcrumb-item active" aria-current="page">{{ teacher.get_full_name }}</li>
                        </ol>
                    </nav>
                </div>
            </div>
            
            <!-- Teacher Profile Card -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Teacher Information</h5>
                            <div>
                                <span class="badge bg-{% if profile.status == 'ACTIVE' %}success{% elif profile.status == 'PENDING' %}warning{% elif profile.status == 'APPROVED' %}primary{% else %}secondary{% endif %} fs-6">
                                    {{ profile.get_status_display }}
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-6">
                                    <h6 class="text-muted mb-3">Basic Information</h6>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Full Name</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ teacher.get_full_name }}</p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Email</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ teacher.email }}</p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Phone</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ profile.phone_number|default:"Not provided" }}</p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Registration Date</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ profile.created_at|date:"F d, Y" }}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Professional Info -->
                                <div class="col-md-6">
                                    <h6 class="text-muted mb-3">Professional Information</h6>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Subjects</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">
                                                {% for subject in profile.subjects.all %}
                                                    <span class="badge bg-primary me-1">{{ subject.name }}</span>
                                                {% empty %}
                                                    No subjects selected
                                                {% endfor %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Experience</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ profile.years_of_experience|default:"0" }} years</p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Qualifications</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">{{ profile.qualifications|default:"Not provided" }}</p>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label text-muted">Bank Info</label>
                                        <div class="col-sm-8">
                                            <p class="form-control-plaintext">
                                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#bankInfoModal">
                                                    <i class="fas fa-eye me-1"></i> View Bank Details
                                                </button>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <div class="d-flex justify-content-end">
                                {% if profile.status == 'PENDING' %}
                                <form method="post" action="{% url 'admin_dashboard:teacher_approval' teacher_id=profile.id %}" class="me-2">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="approve">
                                    <button type="submit" class="btn btn-success">Approve Application</button>
                                </form>
                                <form method="post" action="{% url 'admin_dashboard:teacher_approval' teacher_id=profile.id %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="reject">
                                    <button type="submit" class="btn btn-danger">Reject Application</button>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tabs for different sections -->
            <div class="row">
                <div class="col-12">
                    <ul class="nav nav-tabs" id="teacherDetailTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="classes-tab" data-bs-toggle="tab" data-bs-target="#classes" type="button" role="tab">Classes</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="earnings-tab" data-bs-toggle="tab" data-bs-target="#earnings" type="button" role="tab">Earnings</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="availability-tab" data-bs-toggle="tab" data-bs-target="#availability" type="button" role="tab">Availability</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="leave-tab" data-bs-toggle="tab" data-bs-target="#leave" type="button" role="tab">Leave Requests</button>
                        </li>
                    </ul>
                    <div class="tab-content p-3 border border-top-0 rounded-bottom" id="teacherDetailTabsContent">
                        <!-- Classes Tab -->
                        <div class="tab-pane fade show active" id="classes" role="tabpanel" aria-labelledby="classes-tab">
                            <h5 class="mb-3">Upcoming Classes</h5>
                            <div class="table-responsive mb-4">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Subject</th>
                                            <th>Student</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Meeting Link</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for class in upcoming_classes %}
                                        <tr>
                                            <td>{{ class.subject.name }}</td>
                                            <td>
                                                <a href="{% url 'admin_dashboard:student_detail' class.student.id %}">
                                                    {{ class.student.get_full_name }}
                                                </a>
                                            </td>
                                            <td>{{ class.start_time|date:"d M Y" }}</td>
                                            <td>{{ class.start_time|date:"h:i A" }}</td>
                                            <td>{{ class.duration }} mins</td>
                                            <td>
                                                <span class="badge bg-{% if class.status == 'SCHEDULED' %}info{% elif class.status == 'IN_PROGRESS' %}primary{% else %}secondary{% endif %}">
                                                    {{ class.get_status_display }}
                                                </span>
                                            </td>
                                            <td>
                                                {% if class.meeting_link %}
                                                <a href="{{ class.meeting_link }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-video me-1"></i> Join
                                                </a>
                                                {% else %}
                                                <span class="text-muted">Not available</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No upcoming classes scheduled</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <h5 class="mb-3">Past Classes</h5>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Subject</th>
                                            <th>Student</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Feedback</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for class in past_classes %}
                                        <tr>
                                            <td>{{ class.subject.name }}</td>
                                            <td>
                                                <a href="{% url 'admin_dashboard:student_detail' class.student.id %}">
                                                    {{ class.student.get_full_name }}
                                                </a>
                                            </td>
                                            <td>{{ class.start_time|date:"d M Y" }}</td>
                                            <td>{{ class.start_time|date:"h:i A" }}</td>
                                            <td>{{ class.duration }} mins</td>
                                            <td>
                                                <span class="badge bg-{% if class.status == 'COMPLETED' %}success{% elif class.status == 'CANCELLED' %}danger{% else %}secondary{% endif %}">
                                                    {{ class.get_status_display }}
                                                </span>
                                            </td>
                                            <td>
                                                {% if class.feedback %}
                                                    <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ class.feedback }}">
                                                        <i class="fas fa-comment-dots"></i>
                                                    </button>
                                                {% else %}
                                                    <span class="text-muted">No feedback</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No past classes found</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Earnings Tab -->
                        <div class="tab-pane fade" id="earnings" role="tabpanel" aria-labelledby="earnings-tab">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Month</th>
                                            <th>Classes Conducted</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Payment Date</th>
                                            <th>Reference</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for earning in earnings %}
                                        <tr>
                                            <td>{{ earning.month_year|date:"F Y" }}</td>
                                            <td>{{ earning.class_count }}</td>
                                            <td>₹{{ earning.amount }}</td>
                                            <td>
                                                <span class="badge bg-{% if earning.payment_status == 'COMPLETED' %}success{% elif earning.payment_status == 'PENDING' %}warning{% else %}secondary{% endif %}">
                                                    {{ earning.get_payment_status_display }}
                                                </span>
                                            </td>
                                            <td>{{ earning.payment_date|date:"d M Y"|default:"-" }}</td>
                                            <td>{{ earning.payment_reference|default:"-" }}</td>
                                            <td>
                                                {% if earning.payment_status == 'PENDING' %}
                                                <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#processPaymentModal{{ earning.id }}">
                                                    <i class="fas fa-money-bill-wave me-1"></i> Process
                                                </button>
                                                {% else %}
                                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#paymentDetailModal{{ earning.id }}">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        
                                        <!-- Process Payment Modal -->
                                        {% if earning.payment_status == 'PENDING' %}
                                        <div class="modal fade" id="processPaymentModal{{ earning.id }}" tabindex="-1" aria-labelledby="processPaymentModalLabel{{ earning.id }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="processPaymentModalLabel{{ earning.id }}">Process Payment</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <form method="post" action="{% url 'admin_dashboard:process_teacher_payment' earning_id=earning.id %}">
                                                        {% csrf_token %}
                                                        <div class="modal-body">
                                                            <div class="mb-3">
                                                                <label for="payment_reference{{ earning.id }}" class="form-label">Payment Reference</label>
                                                                <input type="text" class="form-control" id="payment_reference{{ earning.id }}" name="payment_reference" required>
                                                                <small class="form-text text-muted">Enter transaction ID or reference number</small>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="payment_date{{ earning.id }}" class="form-label">Payment Date</label>
                                                                <input type="date" class="form-control" id="payment_date{{ earning.id }}" name="payment_date" value="{{ now|date:'Y-m-d' }}">
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="notes{{ earning.id }}" class="form-label">Notes</label>
                                                                <textarea class="form-control" id="notes{{ earning.id }}" name="notes" rows="3"></textarea>
                                                            </div>
                                                            <div class="alert alert-info">
                                                                <div class="fw-bold">Payment Details:</div>
                                                                <div>Teacher: {{ teacher.get_full_name }}</div>
                                                                <div>Month: {{ earning.month_year|date:"F Y" }}</div>
                                                                <div>Amount: ₹{{ earning.amount }}</div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                            <button type="submit" class="btn btn-success">Confirm Payment</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        {% else %}
                                        <!-- Payment Detail Modal -->
                                        <div class="modal fade" id="paymentDetailModal{{ earning.id }}" tabindex="-1" aria-labelledby="paymentDetailModalLabel{{ earning.id }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="paymentDetailModalLabel{{ earning.id }}">Payment Details</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Teacher</label>
                                                            <div class="col-sm-8">{{ teacher.get_full_name }}</div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Month</label>
                                                            <div class="col-sm-8">{{ earning.month_year|date:"F Y" }}</div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Amount</label>
                                                            <div class="col-sm-8">₹{{ earning.amount }}</div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Status</label>
                                                            <div class="col-sm-8">
                                                                <span class="badge bg-{% if earning.payment_status == 'COMPLETED' %}success{% else %}secondary{% endif %}">
                                                                    {{ earning.get_payment_status_display }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Payment Date</label>
                                                            <div class="col-sm-8">{{ earning.payment_date|date:"d M Y" }}</div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Reference</label>
                                                            <div class="col-sm-8">{{ earning.payment_reference }}</div>
                                                        </div>
                                                        <div class="mb-3 row">
                                                            <label class="col-sm-4 fw-bold">Notes</label>
                                                            <div class="col-sm-8">{{ earning.notes|default:"No notes" }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No earnings records found</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Availability Tab -->
                        <div class="tab-pane fade" id="availability" role="tabpanel" aria-labelledby="availability-tab">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header bg-white">
                                            <h5 class="mb-0">Teacher Availability</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Day</th>
                                                            <th>Time Slots</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for day_num, day_name in days_of_week %}
                                                        <tr>
                                                            <td>{{ day_name }}</td>
                                                            <td>
                                                                {% for slot in availabilities %}
                                                                    {% if slot.day_of_week == day_num %}
                                                                        <span class="badge bg-info me-1">
                                                                            {{ slot.start_time|time:"h:i A" }} - {{ slot.end_time|time:"h:i A" }}
                                                                        </span>
                                                                    {% endif %}
                                                                {% empty %}
                                                                    <span class="text-muted">No availability set</span>
                                                                {% endfor %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Leave Requests Tab -->
                        <div class="tab-pane fade" id="leave" role="tabpanel" aria-labelledby="leave-tab">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Request Date</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for leave in leave_requests %}
                                        <tr>
                                            <td>{{ leave.created_at|date:"d M Y" }}</td>
                                            <td>{{ leave.get_leave_type_display }}</td>
                                            <td>{{ leave.start_date|date:"d M Y" }}</td>
                                            <td>{{ leave.end_date|date:"d M Y" }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ leave.reason }}">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                            <td>
                                                <span class="badge bg-{% if leave.status == 'APPROVED' %}success{% elif leave.status == 'PENDING' %}warning{% elif leave.status == 'REJECTED' %}danger{% else %}secondary{% endif %}">
                                                    {{ leave.get_status_display }}
                                                </span>
                                            </td>
                                            <td>
                                                {% if leave.status == 'PENDING' %}
                                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#leaveActionModal{{ leave.id }}">
                                                    <i class="fas fa-check-circle me-1"></i> Review
                                                </button>
                                                
                                                <!-- Leave Action Modal -->
                                                <div class="modal fade" id="leaveActionModal{{ leave.id }}" tabindex="-1" aria-labelledby="leaveActionModalLabel{{ leave.id }}" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="leaveActionModalLabel{{ leave.id }}">Review Leave Request</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Teacher</label>
                                                                    <div class="col-sm-8">{{ teacher.get_full_name }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Leave Type</label>
                                                                    <div class="col-sm-8">{{ leave.get_leave_type_display }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Period</label>
                                                                    <div class="col-sm-8">
                                                                        {{ leave.start_date|date:"d M Y" }} to {{ leave.end_date|date:"d M Y" }}
                                                                        <small class="d-block text-muted">
                                                                            ({{ leave.duration }} days)
                                                                        </small>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Reason</label>
                                                                    <div class="col-sm-8">{{ leave.reason }}</div>
                                                                </div>
                                                                
                                                                <form method="post" action="{% url 'admin_dashboard:leave_request_action' leave_id=leave.id %}">
                                                                    {% csrf_token %}
                                                                    <div class="mb-3">
                                                                        <label for="comments{{ leave.id }}" class="form-label">Comments</label>
                                                                        <textarea class="form-control" id="comments{{ leave.id }}" name="comments" rows="3"></textarea>
                                                                    </div>
                                                                    <div class="d-flex justify-content-end">
                                                                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" name="action" value="reject" class="btn btn-danger me-2">Reject</button>
                                                                        <button type="submit" name="action" value="approve" class="btn btn-success">Approve</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% else %}
                                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#leaveDetailModal{{ leave.id }}">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                
                                                <!-- Leave Detail Modal -->
                                                <div class="modal fade" id="leaveDetailModal{{ leave.id }}" tabindex="-1" aria-labelledby="leaveDetailModalLabel{{ leave.id }}" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="leaveDetailModalLabel{{ leave.id }}">Leave Request Details</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Teacher</label>
                                                                    <div class="col-sm-8">{{ teacher.get_full_name }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Leave Type</label>
                                                                    <div class="col-sm-8">{{ leave.get_leave_type_display }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Period</label>
                                                                    <div class="col-sm-8">
                                                                        {{ leave.start_date|date:"d M Y" }} to {{ leave.end_date|date:"d M Y" }}
                                                                        <small class="d-block text-muted">
                                                                            ({{ leave.duration }} days)
                                                                        </small>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Reason</label>
                                                                    <div class="col-sm-8">{{ leave.reason }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Status</label>
                                                                    <div class="col-sm-8">
                                                                        <span class="badge bg-{% if leave.status == 'APPROVED' %}success{% elif leave.status == 'REJECTED' %}danger{% else %}secondary{% endif %}">
                                                                            {{ leave.get_status_display }}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Reviewed By</label>
                                                                    <div class="col-sm-8">{{ leave.reviewed_by.get_full_name|default:"Not reviewed yet" }}</div>
                                                                </div>
                                                                <div class="mb-3 row">
                                                                    <label class="col-sm-4 fw-bold">Comments</label>
                                                                    <div class="col-sm-8">{{ leave.admin_comments|default:"No comments" }}</div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No leave requests found</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bank Info Modal -->
<div class="modal fade" id="bankInfoModal" tabindex="-1" aria-labelledby="bankInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bankInfoModalLabel">Bank Account Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3 row">
                    <label class="col-sm-4 fw-bold">Account Holder</label>
                    <div class="col-sm-8">{{ profile.bank_account_name|default:"Not provided" }}</div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 fw-bold">Bank Name</label>
                    <div class="col-sm-8">{{ profile.bank_name|default:"Not provided" }}</div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 fw-bold">Account Number</label>
                    <div class="col-sm-8">{{ profile.bank_account_number|default:"Not provided" }}</div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 fw-bold">IFSC Code</label>
                    <div class="col-sm-8">{{ profile.bank_ifsc|default:"Not provided" }}</div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 fw-bold">Branch</label>
                    <div class="col-sm-8">{{ profile.bank_branch|default:"Not provided" }}</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}